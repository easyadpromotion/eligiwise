<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ELIGIWISE ‚Äì Eligibility Check</title>

<style>
  body {
    font-family: Arial, sans-serif;
    background: #f4f6f8;
  }
  .container {
    max-width: 1000px;
    margin: 20px auto;
    background: #fff;
    padding: 20px;
    border-radius: 10px;
  }
  h1 {
    text-align: center;
    color: #0a4ea3;
  }
  label {
    font-weight: bold;
    display: block;
    margin-top: 10px;
  }
  input, select {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
  }
  button {
    margin-top: 15px;
    padding: 10px 18px;
    background: #0a4ea3;
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: center;
  }
  th {
    background: #0a4ea3;
    color: #fff;
  }
</style>
</head>

<body>

<div class="container">
  <h1>ELIGIWISE ‚Äì Eligibility Check</h1>

  <!-- USER INPUTS -->
  <label>Business Vintage (Years)</label>
  <input type="number" id="vintage" placeholder="Ex: 3">

  <label>Turnover (Lakhs)</label>
  <input type="number" id="turnover" placeholder="Ex: 120">

  <label>Average Bank Balance ‚Äì ABB (Lakhs)</label>
  <input type="number" step="0.01" id="abb" placeholder="Ex: 0.75">

  <label>CIBIL Score</label>
  <input type="number" id="cibil" placeholder="Ex: 720">

  <label>Banking Type</label>
  <select id="bankingType">
    <option value="All">All Accounts Accepted</option>
    <option value="Current">Current Account</option>
    <option value="Savings">Savings Account</option>
  </select>

  <label>Own House</label>
  <select id="ownHouse">
    <option value="Yes">Yes</option>
    <option value="No">No</option>
  </select>

  <label>GST Available</label>
  <select id="gst">
    <option value="Yes">Yes</option>
    <option value="No">No</option>
  </select>

  <label>ITR Available</label>
  <select id="itr">
    <option value="Yes">Yes</option>
    <option value="No">No</option>
  </select>

  <button type="button" onclick="checkEligibility()">üîç Check Eligibility</button>

  <!-- SUMMARY -->
  <div id="summary" style="margin-top:20px;font-weight:bold;"></div>

  <!-- RESULT TABLE -->
  <table id="resultTable" style="display:none;">
    <thead>
      <tr>
        <th>Bank / NBFC</th>
        <th>Status</th>
        <th>Remarks</th>
      </tr>
    </thead>
    <tbody id="resultBody"></tbody>
  </table>

  <!-- DOWNLOAD -->
  <div id="downloadBtns" style="margin-top:15px;display:none;">
    <button type="button" onclick="downloadExcel()">‚¨á Download Excel</button>
    <button type="button" onclick="downloadPDF()">‚¨á Download PDF</button>
  </div>
</div>

<script>
function checkEligibility() {
  console.log("Eligibility check started");

  const policies = JSON.parse(localStorage.getItem("eligiwisePolicies")) || [];

  if (policies.length === 0) {
    alert("No Bank Policies Found. Please add from Admin Panel.");
    return;
  }

  const vintage = Number(document.getElementById("vintage").value || 0);
  const turnover = Number(document.getElementById("turnover").value || 0);
  const abb = Number(document.getElementById("abb").value || 0);
  const cibil = Number(document.getElementById("cibil").value || 0);

  const resultBody = document.getElementById("resultBody");
  const resultTable = document.getElementById("resultTable");
  const summary = document.getElementById("summary");
  const downloadBtns = document.getElementById("downloadBtns");

  resultBody.innerHTML = "";

  let eligibleCount = 0;
  let notEligibleCount = 0;

  policies.forEach(p => {
    let eligible = true;
    let remarks = [];

    if (p.vintage && vintage < p.vintage) {
      eligible = false;
      remarks.push("Low Vintage");
    }
    if (p.turnover && turnover < p.turnover) {
      eligible = false;
      remarks.push("Low Turnover");
    }
    if (p.abb && abb < p.abb) {
      eligible = false;
      remarks.push("Low ABB");
    }
    if (p.cibil && cibil < p.cibil) {
      eligible = false;
      remarks.push("Low CIBIL");
    }

    if (eligible) eligibleCount++;
    else notEligibleCount++;

    resultBody.innerHTML += `
      <tr>
        <td>${p.bankName}</td>
        <td style="color:${eligible ? 'green' : 'red'};font-weight:bold;">
          ${eligible ? 'Eligible' : 'Not Eligible'}
        </td>
        <td>${remarks.join(", ") || "All conditions matched"}</td>
      </tr>
    `;
  });

  summary.innerHTML = `
    ‚úÖ Eligible Banks: <span style="color:green">${eligibleCount}</span>
    &nbsp;&nbsp;|&nbsp;&nbsp;
    ‚ùå Not Eligible Banks: <span style="color:red">${notEligibleCount}</span>
  `;

  resultTable.style.display = "table";
  downloadBtns.style.display = "block";
}

function downloadExcel() {
  const table = document.getElementById("resultTable").outerHTML;
  const blob = new Blob([table], { type: "application/vnd.ms-excel" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "Eligiwise_Eligibility.xls";
  a.click();
}

function downloadPDF() {
  const table = document.getElementById("resultTable").outerHTML;
  const win = window.open("", "", "width=900,height=700");
  win.document.write("<html><head><title>Eligibility Result</title></head><body>");
  win.document.write(table);
  win.document.write("</body></html>");
  win.document.close();
  win.print();
}
</script>

</body>
</html>
