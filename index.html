<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ELIGIWISE ‚Äì Eligibility Check</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f6f8;
}
.container{
  max-width:1100px;
  margin:20px auto;
  background:#fff;
  padding:20px;
  border-radius:10px;
}
h1{
  text-align:center;
  color:#0A4EA3;
}
label{
  font-weight:bold;
  margin-top:10px;
  display:block;
}
input,select{
  width:100%;
  padding:8px;
  margin-top:5px;
}
button{
  background:#0A4EA3;
  color:#fff;
  border:none;
  padding:10px 16px;
  border-radius:6px;
  cursor:pointer;
  margin-top:15px;
}
button:hover{opacity:0.9;}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
th,td{
  border:1px solid #ccc;
  padding:8px;
  text-align:center;
}
th{
  background:#0A4EA3;
  color:#fff;
}
.status-yes{color:green;font-weight:bold;}
.status-no{color:red;font-weight:bold;}

.summary{
  margin-top:15px;
  font-weight:bold;
}

.downloads{
  margin-top:15px;
}
.downloads button{
  margin-right:10px;
}
</style>
</head>

<body>
<div class="container">

<h1>ELIGIWISE ‚Äì Eligibility Check</h1>

<label>Business Vintage (Years)</label>
<input id="vintage" type="number">

<label>Turnover (Lakhs)</label>
<input id="turnover" type="number">

<label>Average Bank Balance ‚Äì ABB (Lakhs)</label>
<input id="abb" type="number" step="0.01">

<label>CIBIL Score</label>
<input id="cibil" type="number">

<label>Banking Type</label>
<select id="bankingType">
  <option>All Accounts Accepted</option>
  <option>Only Current Account</option>
  <option>Only OD/CC Accounts</option>
  <option>Only Saving Accounts</option>
  <option>CA+OD/CC</option>
</select>

<label>Own House</label>
<select id="ownHouse">
  <option>Yes</option>
  <option>No</option>
</select>

<label>GST Available</label>
<select id="gst">
  <option>Yes</option>
  <option>No</option>
</select>

<label>ITR Available</label>
<select id="itr">
  <option>Yes</option>
  <option>No</option>
</select>

<button onclick="checkEligibility()">üîç Check Eligibility</button>

<div id="summary" class="summary"></div>

<table id="resultTable" style="display:none;">
<thead>
<tr>
  <th>Bank / NBFC</th>
  <th>Eligible Loan (‚Çπ Lakhs)</th>
  <th>Status</th>
  <th>Remarks</th>
</tr>
</thead>
<tbody></tbody>
</table>

<div class="downloads" id="downloads" style="display:none;">
  <button onclick="downloadExcel()">üì• Download Excel</button>
  <button onclick="downloadPDF()">üìÑ Download PDF</button>
</div>

</div>

<script>
function checkEligibility(){
  const policies = JSON.parse(localStorage.getItem("eligiwisePolicies")) || [];
  if(policies.length===0){
    alert("No Bank Policies Found. Please add from Admin Panel.");
    return;
  }

  const vintage = +document.getElementById("vintage").value;
  const turnover = +document.getElementById("turnover").value;
  const abb = +document.getElementById("abb").value;
  const cibil = +document.getElementById("cibil").value;
  const bankingType = document.getElementById("bankingType").value;
  const ownHouse = document.getElementById("ownHouse").value;
  const gst = document.getElementById("gst").value;
  const itr = document.getElementById("itr").value;

  let eligibleCount=0, notEligibleCount=0;
  const tbody=document.querySelector("#resultTable tbody");
  tbody.innerHTML="";

  policies.forEach(p=>{
    let isEligible=true;
    let remark="All conditions matched";

    if(vintage < (p.vintage||0)) isEligible=false;
    if(turnover < (p.turnover||0)) isEligible=false;
    if(abb < (p.abb||0)) isEligible=false;
    if(cibil < (p.cibil||0)) isEligible=false;
    if(p.bankingType && p.bankingType!==bankingType) isEligible=false;
    if(p.ownHouse && p.ownHouse!==ownHouse) isEligible=false;
    if(p.gst==="Yes" && gst!=="Yes") isEligible=false;
    if(p.itr==="Yes" && itr!=="Yes") isEligible=false;

    let loan="-";
    if(isEligible){
      eligibleCount++;
      loan=(turnover*0.3).toFixed(2);
    }else{
      notEligibleCount++;
      remark="Criteria mismatch";
    }

    const row=document.createElement("tr");
    row.innerHTML=`
      <td>${p.bankName}</td>
      <td>${loan}</td>
      <td class="${isEligible?'status-yes':'status-no'}">
        ${isEligible?'Eligible':'Not Eligible'}
      </td>
      <td>${remark}</td>
    `;
    tbody.appendChild(row);
  });

  document.getElementById("resultTable").style.display="table";
  document.getElementById("downloads").style.display="block";
  document.getElementById("summary").innerHTML=
    `‚úÖ Eligible: ${eligibleCount} &nbsp;&nbsp; ‚ùå Not Eligible: ${notEligibleCount}`;
}

function downloadExcel(){
  let csv="Bank / NBFC,Eligible Loan (Lakhs),Status,Remarks\n";
  document.querySelectorAll("#resultTable tbody tr").forEach(r=>{
    const c=r.querySelectorAll("td");
    csv+=`${c[0].innerText},${c[1].innerText},${c[2].innerText},${c[3].innerText}\n`;
  });
  const blob=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="Eligibility_Result.csv";
  a.click();
}

function downloadPDF(){
  let text="ELIGIWISE ELIGIBILITY RESULT\n\n";
  document.querySelectorAll("#resultTable tbody tr").forEach(r=>{
    const c=r.querySelectorAll("td");
    text+=`${c[0].innerText} | Loan:${c[1].innerText} | ${c[2].innerText}\n`;
  });
  const blob=new Blob([text],{type:"application/pdf"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="Eligibility_Result.pdf";
  a.click();
}
</script>

</body>
</html>
