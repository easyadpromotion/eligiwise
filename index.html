<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ELIGIWISE ‚Äì Eligibility Check</title>

<!-- Excel -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<!-- PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>

<style>
body { font-family: Arial; background:#f4f6f8; }
.container { max-width:1100px; margin:20px auto; background:#fff; padding:20px; border-radius:10px; }
h1 { text-align:center; color:#0A4EA3; }

label { font-weight:bold; margin-top:10px; display:block; }
input, select { width:100%; padding:8px; margin-top:5px; }

button {
  background:#0A4EA3; color:#fff; border:none;
  padding:10px 15px; border-radius:6px;
  margin-top:15px; cursor:pointer;
}

table { width:100%; border-collapse:collapse; margin-top:20px; }
th, td { border:1px solid #ccc; padding:8px; text-align:center; }
th { background:#0A4EA3; color:#fff; }

.eligible { color:green; font-weight:bold; }
.noteligible { color:red; font-weight:bold; }

.summary { margin-top:15px; font-weight:bold; }
.downloads button { margin-right:10px; }
</style>
</head>

<body>
<div class="container">
<h1>ELIGIWISE ‚Äì Eligibility Check</h1>

<!-- INPUTS -->
<label>Business Vintage (Years)</label>
<input id="vintage" type="number">

<label>Turnover (Lakhs)</label>
<input id="turnover" type="number">

<label>Average Bank Balance ‚Äì ABB (Lakhs)</label>
<input id="abb" type="number" step="0.01">

<label>CIBIL Score</label>
<input id="cibil" type="number">

<label>Banking Type</label>
<select id="bankingType">
  <option>All Accounts Accepted</option>
  <option>Only Current Account</option>
  <option>Only OD/CC Accounts</option>
  <option>Only Saving Accounts</option>
  <option>CA+OD/CC</option>
</select>

<label>Own House</label>
<select id="ownHouse">
  <option>Yes</option>
  <option>No</option>
</select>

<label>GST Available</label>
<select id="gst">
  <option>Yes</option>
  <option>No</option>
</select>

<label>ITR Available</label>
<select id="itr">
  <option>Yes</option>
  <option>No</option>
</select>

<button onclick="checkEligibility()">üîç Check Eligibility</button>

<!-- SUMMARY -->
<div id="summary" class="summary"></div>

<!-- RESULT TABLE -->
<table id="resultTable" style="display:none;">
<thead>
<tr>
<th>Bank / NBFC</th>
<th>Status</th>
<th>Max Loan (Lakhs)</th>
<th>Remarks</th>
</tr>
</thead>
<tbody></tbody>
</table>

<div class="downloads" id="downloads" style="display:none;">
<button onclick="downloadExcel()">‚¨á Download Excel</button>
<button onclick="downloadPDF()">‚¨á Download PDF</button>
</div>

</div>

<script>
function checkEligibility() {

const policies = JSON.parse(localStorage.getItem("eligiwisePolicies")) || [];
if (policies.length === 0) {
  alert("No Bank Policies Found. Please add from Admin Panel.");
  return;
}

const input = {
  vintage: Number(vintage.value),
  turnover: Number(turnover.value),
  abb: Number(abb.value),
  cibil: Number(cibil.value),
  bankingType: bankingType.value,
  ownHouse: ownHouse.value,
  gst: gst.value,
  itr: itr.value
};

let eligibleCount = 0, notEligibleCount = 0;
let tbody = document.querySelector("#resultTable tbody");
tbody.innerHTML = "";

policies.forEach(p => {

  let eligible = false;
  let maxLoan = 0;
  let reason = "Conditions not matched";

  // ABB Program
  if (p.abbPrograms) {
    p.abbPrograms.forEach(pr => {
      if (input.abb >= pr.min && input.abb <= pr.max) {
        eligible = true;
        maxLoan = Math.max(maxLoan, pr.max);
        reason = "Eligible via ABB Program";
      }
    });
  }

  // ITR Program
  if (!eligible && p.itrPrograms && input.itr === "Yes") {
    p.itrPrograms.forEach(pr => {
      eligible = true;
      maxLoan = Math.max(maxLoan, pr.max);
      reason = "Eligible via ITR Program";
    });
  }

  // GST Program
  if (!eligible && p.gstPrograms && input.gst === "Yes") {
    p.gstPrograms.forEach(pr => {
      eligible = true;
      maxLoan = Math.max(maxLoan, pr.max);
      reason = "Eligible via GST Program";
    });
  }

  let tr = document.createElement("tr");
  tr.innerHTML = `
    <td>${p.bankName}</td>
    <td class="${eligible ? 'eligible':'noteligible'}">${eligible ? 'Eligible':'Not Eligible'}</td>
    <td>${eligible ? maxLoan : '-'}</td>
    <td>${eligible ? 'All conditions matched' : reason}</td>
  `;
  tbody.appendChild(tr);

  eligible ? eligibleCount++ : notEligibleCount++;
});

document.getElementById("resultTable").style.display = "table";
document.getElementById("downloads").style.display = "block";

summary.innerHTML = `
‚úÖ Eligible : ${eligibleCount} &nbsp;&nbsp;
‚ùå Not Eligible : ${notEligibleCount}
`;
}

function downloadExcel() {
  let wb = XLSX.utils.book_new();
  let ws = XLSX.utils.table_to_sheet(document.getElementById("resultTable"));
  XLSX.utils.book_append_sheet(wb, ws, "Eligibility");
  XLSX.writeFile(wb, "ELIGIWISE_Eligibility.xlsx");
}

function downloadPDF() {
  const { jsPDF } = window.jspdf;
  let doc = new jsPDF();
  doc.text("ELIGIWISE ‚Äì Eligibility Report", 14, 15);
  doc.autoTable({ html:"#resultTable", startY:20 });
  doc.save("ELIGIWISE_Eligibility.pdf");
}
</script>

</body>
</html>
