<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ELIGIWISE | Bank / NBFC Policy Admin</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f6f8; margin:0; padding:0; }
    .container { max-width:1300px; margin:20px auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.08); }
    h1 { text-align:center; color:#0A4EA3; margin-top:0; }
    h3 { background:#0A4EA3; color:#fff; padding:8px; margin-top:25px; font-size:15px; border-radius:4px; }
    label { font-weight:bold; font-size:13px; }
    input, select {
      width:100%; padding:6px; margin:4px 0 10px;
      border:1px solid #ccc; border-radius:4px; font-size:13px; box-sizing:border-box;
    }
    .row { display:grid; grid-template-columns:repeat(3,1fr); gap:15px; }
    @media(max-width:900px){ .row{grid-template-columns:repeat(2,1fr);} }
    @media(max-width:600px){ .row{grid-template-columns:1fr;} }
    button {
      padding:6px 10px; background:#0A4EA3; color:#fff;
      border:none; border-radius:4px; cursor:pointer; font-size:13px;
    }
    .add-btn { font-size:12px; margin:5px 0; }
    .program-row {
      display:grid;
      grid-template-columns:1fr 1fr 1fr auto;
      gap:10px;
      margin-bottom:8px;
    }
    .remove-btn { background:#c0392b; }
    table { width:100%; border-collapse:collapse; margin-top:20px; font-size:13px; }
    th, td { border:1px solid #ccc; padding:6px 8px; text-align:center; }
    th { background:#0A4EA3; color:#fff; }
    .edit-btn { background:#27ae60; }
  </style>
</head>
<body>
<div class="container">
  <h1>ELIGIWISE ‚Äì Bank / NBFC Policy Admin</h1>

  <!-- BANK / NBFC DETAILS -->
  <h3>Bank / NBFC Details</h3>
  <label>Bank / NBFC Name</label>
  <input id="bankName" placeholder="Ex: HDFC Bank, Tata Capital, Piramal">

  <!-- SECTION A -->
  <h3>SECTION A ‚Äì BASIC PRODUCT DETAILS</h3>
  <div class="row">
    <div>
      <label>Product Type</label>
      <select id="productType">
        <option>STBL</option>
        <option>HTBL</option>
        <option>BOTH</option>
      </select>
    </div>
    <div>
      <label>Loan Amount (Min‚ÄìMax Lakhs)</label>
      <input id="loanAmount" placeholder="Ex: 2‚Äì50">
    </div>
    <div>
      <label>Tenure (Min‚ÄìMax Months)</label>
      <input id="tenure" placeholder="Ex: 12‚Äì60">
    </div>
  </div>
  <div class="row">
    <div>
      <label>ROI (Min‚ÄìMax %)</label>
      <input id="roi" placeholder="Ex: 14‚Äì24">
    </div>
    <div>
      <label>PF (Min‚ÄìMax %)</label>
      <input id="pf" placeholder="Ex: 0‚Äì3">
    </div>
  </div>

  <!-- SECTION B -->
  <h3>SECTION B ‚Äì APPLICANT & CO-APPLICANT</h3>
  <div class="row">
    <div>
      <label>Applicant Age (Min‚ÄìMax)</label>
      <input id="applicantAge" placeholder="Ex: 21‚Äì60">
    </div>
    <div>
      <label>Co-Applicant Mandatory</label>
      <select id="coApplicantMandatory">
        <option>No</option>
        <option>Yes</option>
      </select>
    </div>
    <div>
      <label>Residence Type Required</label>
      <select id="residenceType">
        <option>Any</option>
        <option>Own House</option>
        <option>Rented</option>
      </select>
    </div>
  </div>

  <!-- SECTION C -->
  <h3>SECTION C ‚Äì BUSINESS & BANKING</h3>
  <div class="row">
    <div>
      <label>Min Business Vintage (Years)</label>
      <input id="minVintage" placeholder="Ex: 2">
    </div>
    <div>
      <label>Min Turnover (Lakhs)</label>
      <input id="minTurnover" placeholder="Ex: 10">
    </div>
    <div>
      <label>Banking Type Allowed</label>
      <select id="bankingTypeAllowed">
        <option>All</option>
        <option>Current</option>
        <option>Savings</option>
      </select>
    </div>
  </div>

  <!-- SECTION D -->
  <h3>SECTION D ‚Äì CREDIT & OBLIGATIONS</h3>
  <div class="row">
    <div>
      <label>Min CIBIL</label>
      <input id="minCibil" placeholder="Ex: 700">
    </div>
    <div>
      <label>Own House Required</label>
      <select id="ownHouseRequired">
        <option>No</option>
        <option>Yes</option>
      </select>
    </div>
    <div>
      <label>Max FOIR % (optional)</label>
      <input id="maxFoir" placeholder="Ex: 45">
    </div>
  </div>

  <!-- SECTION E ‚Äì PROGRAMS -->
  <h3>SECTION E ‚Äì PROGRAMS</h3>

  <!-- Base Program -->
  <label>Base Program (Standard Policy)</label>
  <div class="row">
    <div>
      <label>Min Vintage (Years)</label>
      <input id="bpMinVintage" placeholder="Ex: 2">
    </div>
    <div>
      <label>Min Turnover (Lakhs)</label>
      <input id="bpMinTurnover" placeholder="Ex: 10">
    </div>
    <div>
      <label>Min ABB (Lakhs)</label>
      <input id="bpMinAbb" placeholder="Ex: 0.5">
    </div>
  </div>
  <div class="row">
    <div>
      <label>Min CIBIL</label>
      <input id="bpMinCibil" placeholder="Ex: 700">
    </div>
    <div>
      <label>Banking Type</label>
      <select id="bpBankingType">
        <option>All</option>
        <option>Current</option>
        <option>Savings</option>
      </select>
    </div>
    <div>
      <label>Own House Required</label>
      <select id="bpOwnHouseRequired">
        <option>No</option>
        <option>Yes</option>
      </select>
    </div>
  </div>
  <div class="row">
    <div>
      <label>Max Loan (Lakhs)</label>
      <input id="bpMaxLoan" placeholder="Ex: 20">
    </div>
  </div>

  <!-- ABB Programs -->
  <label>ABB Programs (Min‚ÄìMax ABB & Max Loan)</label>
  <div id="abbPrograms"></div>
  <button class="add-btn" type="button" onclick="addProgramRow('abbPrograms')">+ Add ABB Program</button>

  <!-- ITR Programs -->
  <label>ITR Programs (For ITR Available Customers)</label>
  <div id="itrPrograms"></div>
  <button class="add-btn" type="button" onclick="addProgramRow('itrPrograms')">+ Add ITR Program</button>

  <!-- GST Programs -->
  <label>GST Programs (For GST Available Customers)</label>
  <div id="gstPrograms"></div>
  <button class="add-btn" type="button" onclick="addProgramRow('gstPrograms')">+ Add GST Program</button>

  <!-- SECTION F ‚Äì CUSTOM FIELDS -->
  <h3>SECTION F ‚Äì CUSTOM / FUTURE PARAMETERS</h3>
  <label>Custom Fields (for any extra conditions)</label>
  <div id="customFields"></div>
  <button class="add-btn" type="button" onclick="addCustomField()">+ Add Custom Field</button>

  <!-- SAVE BUTTON -->
  <div style="margin-top:20px;">
    <button type="button" onclick="savePolicy()">üíæ Save Policy</button>
    <button type="button" class="remove-btn" onclick="resetForm()">Clear Form</button>
  </div>

  <!-- SAVED POLICIES TABLE -->
  <h3>Saved Policies</h3>
  <table id="policyTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Bank</th>
        <th>Product</th>
        <th>Min Turnover</th>
        <th>Min CIBIL</th>
        <th>ABB Base</th>
        <th>GST Prog?</th>
        <th>ITR Prog?</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
  let editIndex = null;

  function addProgramRow(containerId, data = null) {
    const container = document.getElementById(containerId);
    const row = document.createElement("div");
    row.className = "program-row";

    row.innerHTML = `
      <input placeholder="Min" value="${data ? (data.min || "") : ""}">
      <input placeholder="Max" value="${data ? (data.max || "") : ""}">
      <input placeholder="Max Loan (L)" value="${data ? (data.maxLoan || "") : ""}">
      <button type="button" class="remove-btn" onclick="this.parentElement.remove()">‚ùå</button>
    `;
    container.appendChild(row);
  }

  function addCustomField(data = null) {
    const container = document.getElementById("customFields");
    const row = document.createElement("div");
    row.className = "program-row";
    row.innerHTML = `
      <input placeholder="Field Name" value="${data ? (data.name || "") : ""}">
      <input placeholder="Value / Range" value="${data ? (data.value || "") : ""}">
      <input placeholder="Remarks (optional)" value="${data ? (data.remark || "") : ""}">
      <button type="button" class="remove-btn" onclick="this.parentElement.remove()">‚ùå</button>
    `;
    container.appendChild(row);
  }

  function collectPrograms(containerId) {
    const container = document.getElementById(containerId);
    const rows = Array.from(container.querySelectorAll(".program-row"));
    return rows.map(r => {
      const inputs = r.querySelectorAll("input");
      return {
        min: Number(inputs[0].value) || 0,
        max: Number(inputs[1].value) || 0,
        maxLoan: Number(inputs[2].value) || 0
      };
    }).filter(p => p.min || p.max || p.maxLoan);
  }

  function collectCustomFields() {
    const container = document.getElementById("customFields");
    const rows = Array.from(container.querySelectorAll(".program-row"));
    return rows.map(r => {
      const inputs = r.querySelectorAll("input");
      return {
        name: inputs[0].value.trim(),
        value: inputs[1].value.trim(),
        remark: inputs[2].value.trim()
      };
    }).filter(f => f.name || f.value || f.remark);
  }

  function savePolicy() {
    const bankName = document.getElementById("bankName").value.trim();
    if (!bankName) {
      alert("Bank / NBFC Name is required.");
      return;
    }

    const policy = {
      bankName,
      productType: document.getElementById("productType").value,
      loanAmount: document.getElementById("loanAmount").value,
      tenure: document.getElementById("tenure").value,
      roi: document.getElementById("roi").value,
      pf: document.getElementById("pf").value,
      applicantAge: document.getElementById("applicantAge").value,
      coApplicantMandatory: document.getElementById("coApplicantMandatory").value,
      residenceType: document.getElementById("residenceType").value,
      minVintage: Number(document.getElementById("minVintage").value) || 0,
      minTurnover: Number(document.getElementById("minTurnover").value) || 0,
      bankingTypeAllowed: document.getElementById("bankingTypeAllowed").value,
      minCibil: Number(document.getElementById("minCibil").value) || 0,
      ownHouseRequired: document.getElementById("ownHouseRequired").value,
      maxFoir: Number(document.getElementById("maxFoir").value) || 0,
      baseProgram: {
        minVintage: Number(document.getElementById("bpMinVintage").value) || 0,
        minTurnover: Number(document.getElementById("bpMinTurnover").value) || 0,
        minAbb: Number(document.getElementById("bpMinAbb").value) || 0,
        minCibil: Number(document.getElementById("bpMinCibil").value) || 0,
        bankingType: document.getElementById("bpBankingType").value,
        ownHouseRequired: document.getElementById("bpOwnHouseRequired").value,
        maxLoan: Number(document.getElementById("bpMaxLoan").value) || 0
      },
      abbPrograms: collectPrograms("abbPrograms"),
      itrPrograms: collectPrograms("itrPrograms"),
      gstPrograms: collectPrograms("gstPrograms"),
      customFields: collectCustomFields()
    };

    let policies = JSON.parse(localStorage.getItem("eligiwisePolicies")) || [];
    if (editIndex !== null) {
      policies[editIndex] = policy;
    } else {
      policies.push(policy);
    }
    localStorage.setItem("eligiwisePolicies", JSON.stringify(policies));
    alert("Policy saved successfully.");
    resetForm();
    loadTable();
  }

  function resetForm() {
    editIndex = null;
    document.querySelectorAll("input").forEach(i => i.value = "");
    document.getElementById("productType").value = "STBL";
    document.getElementById("coApplicantMandatory").value = "No";
    document.getElementById("residenceType").value = "Any";
    document.getElementById("bankingTypeAllowed").value = "All";
    document.getElementById("ownHouseRequired").value = "No";
    document.getElementById("bpBankingType").value = "All";
    document.getElementById("bpOwnHouseRequired").value = "No";
    document.getElementById("abbPrograms").innerHTML = "";
    document.getElementById("itrPrograms").innerHTML = "";
    document.getElementById("gstPrograms").innerHTML = "";
    document.getElementById("customFields").innerHTML = "";
  }

  function loadTable() {
    const tbody = document.querySelector("#policyTable tbody");
    tbody.innerHTML = "";
    const policies = JSON.parse(localStorage.getItem("eligiwisePolicies")) || [];
    policies.forEach((p, index) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${index + 1}</td>
        <td>${p.bankName}</td>
        <td>${p.productType || ""}</td>
        <td>${p.minTurnover || ""}</td>
        <td>${p.minCibil || ""}</td>
        <td>${p.baseProgram ? (p.baseProgram.minAbb || "") : ""}</td>
        <td>${p.gstPrograms && p.gstPrograms.length ? "Yes" : "No"}</td>
        <td>${p.itrPrograms && p.itrPrograms.length ? "Yes" : "No"}</td>
        <td><button type="button" class="edit-btn" onclick="editPolicy(${index})">Edit</button></td>
      `;
      tbody.appendChild(tr);
    });
  }

  function editPolicy(index) {
    const policies = JSON.parse(localStorage.getItem("eligiwisePolicies")) || [];
    const p = policies[index];
    if (!p) return;
    editIndex = index;

    document.getElementById("bankName").value = p.bankName || "";
    document.getElementById("productType").value = p.productType || "STBL";
    document.getElementById("loanAmount").value = p.loanAmount || "";
    document.getElementById("tenure").value = p.tenure || "";
    document.getElementById("roi").value = p.roi || "";
    document.getElementById("pf").value = p.pf || "";
    document.getElementById("applicantAge").value = p.applicantAge || "";
    document.getElementById("coApplicantMandatory").value = p.coApplicantMandatory || "No";
    document.getElementById("residenceType").value = p.residenceType || "Any";
    document.getElementById("minVintage").value = p.minVintage || "";
    document.getElementById("minTurnover").value = p.minTurnover || "";
    document.getElementById("bankingTypeAllowed").value = p.bankingTypeAllowed || "All";
    document.getElementById("minCibil").value = p.minCibil || "";
    document.getElementById("ownHouseRequired").value = p.ownHouseRequired || "No";
    document.getElementById("maxFoir").value = p.maxFoir || "";

    if (p.baseProgram) {
      document.getElementById("bpMinVintage").value = p.baseProgram.minVintage || "";
      document.getElementById("bpMinTurnover").value = p.baseProgram.minTurnover || "";
      document.getElementById("bpMinAbb").value = p.baseProgram.minAbb || "";
      document.getElementById("bpMinCibil").value = p.baseProgram.minCibil || "";
      document.getElementById("bpBankingType").value = p.baseProgram.bankingType || "All";
      document.getElementById("bpOwnHouseRequired").value = p.baseProgram.ownHouseRequired || "No";
      document.getElementById("bpMaxLoan").value = p.baseProgram.maxLoan || "";
    }

    document.getElementById("abbPrograms").innerHTML = "";
    (p.abbPrograms || []).forEach(pr => addProgramRow("abbPrograms", pr));

    document.getElementById("itrPrograms").innerHTML = "";
    (p.itrPrograms || []).forEach(pr => addProgramRow("itrPrograms", pr));

    document.getElementById("gstPrograms").innerHTML = "";
    (p.gstPrograms || []).forEach(pr => addProgramRow("gstPrograms", pr));

    document.getElementById("customFields").innerHTML = "";
    (p.customFields || []).forEach(cf => addCustomField(cf));
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  loadTable();
</script>
</body>
</html>
