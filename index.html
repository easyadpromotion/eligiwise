<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ELIGIWISE ‚Äì Eligibility Check</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
}

.container {
  max-width: 1000px;
  margin: 20px auto;
  background: #fff;
  padding: 20px;
  border-radius: 10px;
}

h1 {
  text-align: center;
  color: #044aa3;
}

label {
  font-weight: bold;
  margin-top: 10px;
  display: block;
}

input, select {
  width: 100%;
  padding: 6px;
  margin-top: 4px;
}

button {
  margin-top: 15px;
  padding: 10px 14px;
  background: #044aa3;
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

button:hover {
  background: #03347a;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
}

th, td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: center;
}

th {
  background: #044aa3;
  color: #fff;
  font-weight: bold;
}

.eligible {
  color: green;
  font-weight: bold;
}

.not-eligible {
  color: red;
  font-weight: bold;
}

#summary {
  margin-top: 15px;
  font-weight: bold;
}
</style>
</head>

<body>
<div class="container">

<h1>ELIGIWISE ‚Äì Eligibility Check</h1>

<label>Business Vintage (Years)</label>
<input id="vintage">

<label>Turnover (Lakhs)</label>
<input id="turnover">

<label>Average Bank Balance ‚Äì ABB (Lakhs)</label>
<input id="abb">

<label>CIBIL Score</label>
<input id="cibil">

<label>Banking Type</label>
<select id="bankingType">
  <option>All Accounts Accepted</option>
  <option>Only Current Account</option>
  <option>Only OD/CC Accounts</option>
</select>

<label>Own House</label>
<select id="ownHouse">
  <option>Yes</option>
  <option>No</option>
</select>

<label>GST Available</label>
<select id="gst">
  <option>Yes</option>
  <option>No</option>
</select>

<label>ITR Available</label>
<select id="itr">
  <option>Yes</option>
  <option>No</option>
</select>

<button onclick="checkEligibility()">üîç Check Eligibility</button>

<div id="summary"></div>

<table id="resultTable" style="display:none">
<thead>
<tr>
  <th>Bank / NBFC</th>
  <th>Status</th>
  <th>Remarks</th>
</tr>
</thead>
<tbody></tbody>
</table>

<div id="downloadBtns" style="display:none">
  <button onclick="downloadExcel()">üì• Download Excel</button>
  <button onclick="downloadPDF()">üìÑ Download PDF</button>
</div>

</div>

<!-- ===== PDF LIBRARIES ===== -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>

<script>
function checkEligibility() {
  const policies = JSON.parse(localStorage.getItem("eligiwisePolicies")) || [];

  if (policies.length === 0) {
    alert("No Bank Policies Found. Please add from Admin Panel.");
    return;
  }

  const vintage = Number(document.getElementById("vintage").value);
  const turnover = Number(document.getElementById("turnover").value);
  const abb = Number(document.getElementById("abb").value);
  const cibil = Number(document.getElementById("cibil").value);
  const bankingType = document.getElementById("bankingType").value;
  const ownHouse = document.getElementById("ownHouse").value;
  const gst = document.getElementById("gst").value;
  const itr = document.getElementById("itr").value;

  const tbody = document.querySelector("#resultTable tbody");
  tbody.innerHTML = "";

  let eligibleCount = 0;
  let notEligibleCount = 0;

  policies.forEach(p => {
    let eligible = true;
    let remarks = [];

    if (vintage < (p.vintage || 0)) { eligible = false; remarks.push("Low vintage"); }
    if (turnover < (p.turnover || 0)) { eligible = false; remarks.push("Low turnover"); }
    if (abb < (p.abb || 0)) { eligible = false; remarks.push("Low ABB"); }
    if (cibil < (p.cibil || 0)) { eligible = false; remarks.push("Low CIBIL"); }
    if (p.gst === "Yes" && gst === "No") { eligible = false; remarks.push("GST required"); }
    if (p.itr === "Yes" && itr === "No") { eligible = false; remarks.push("ITR required"); }

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${p.bankName}</td>
      <td class="${eligible ? "eligible" : "not-eligible"}">
        ${eligible ? "Eligible" : "Not Eligible"}
      </td>
      <td>${eligible ? "All conditions matched" : remarks.join(", ")}</td>
    `;
    tbody.appendChild(tr);

    eligible ? eligibleCount++ : notEligibleCount++;
  });

  document.getElementById("resultTable").style.display = "table";
  document.getElementById("downloadBtns").style.display = "block";

  document.getElementById("summary").innerHTML =
    `‚úÖ Eligible: ${eligibleCount} | ‚ùå Not Eligible: ${notEligibleCount}`;
}

function downloadExcel() {
  let csv = "Bank / NBFC,Status,Remarks\n";
  document.querySelectorAll("#resultTable tbody tr").forEach(row => {
    const cols = row.querySelectorAll("td");
    csv += `${cols[0].innerText},${cols[1].innerText},${cols[2].innerText}\n`;
  });

  const blob = new Blob([csv], { type: "text/csv" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "Eligiwise_Eligibility.csv";
  a.click();
}

function downloadPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.text("Eligiwise ‚Äì Eligibility Result", 14, 15);

  let body = [];
  document.querySelectorAll("#resultTable tbody tr").forEach(row => {
    const cols = row.querySelectorAll("td");
    body.push([cols[0].innerText, cols[1].innerText, cols[2].innerText]);
  });

  doc.autoTable({
    startY: 25,
    head: [["Bank / NBFC", "Status", "Remarks"]],
    body: body,
    theme: "grid",
    headStyles: { fillColor: [4, 74, 163], textColor: 255 }
  });

  doc.save("Eligiwise_Eligibility.pdf");
}
</script>

</body>
</html>
