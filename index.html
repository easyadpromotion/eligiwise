<script>
function checkEligibility() {

  let vintage = Number(document.getElementById("vintage").value);
  let turnover = Number(document.getElementById("turnover").value);
  let cibil = Number(document.getElementById("cibil").value);
  let abb = Number(document.getElementById("abb").value);
  let ownHouse = document.getElementById("ownHouse").value;
  let gst = document.getElementById("gst").value;
  let itr = document.getElementById("itr").value;
  let activeLoans = Number(document.getElementById("activeLoans").value);
  let recentLoans = Number(document.getElementById("recentLoans").value);

  let banks = JSON.parse(localStorage.getItem("eligiwiseBanks")) || [];

  let table = document.getElementById("resultTable");
  let tbody = table.querySelector("tbody");
  tbody.innerHTML = "";
  table.style.display = "table";

  if (banks.length === 0) {
    alert("No bank policies added. Please add from Admin Panel.");
    return;
  }

  banks.forEach(b => {
    let status = "Eligible";
    let reason = "Meets policy";
    let cls = "green";

    if (b.minVintage && vintage < b.minVintage) {
      status="Rejected"; reason="Business vintage not met"; cls="red";
    }
    else if (b.minTurnover && turnover < b.minTurnover) {
      status="Rejected"; reason="Turnover below policy"; cls="red";
    }
    else if (b.minCibil && cibil < b.minCibil) {
      status="Rejected"; reason="Low CIBIL score"; cls="red";
    }
    else if (b.minAbb && abb < b.minAbb) {
      status="Borderline"; reason="Low ABB"; cls="orange";
    }
    else if (b.ownHouse==="true" && ownHouse==="no") {
      status="Rejected"; reason="Own house required"; cls="red";
    }
    else if (b.gst==="true" && gst==="no") {
      status="Rejected"; reason="GST mandatory"; cls="red";
    }
    else if (b.itr==="true" && itr==="no") {
      status="Rejected"; reason="ITR mandatory"; cls="red";
    }
    else if (b.maxActive && activeLoans > b.maxActive) {
      status="Rejected"; reason="Too many active loans"; cls="red";
    }
    else if (b.maxRecent && recentLoans > b.maxRecent) {
      status="Rejected"; reason="Too many recent loans"; cls="red";
    }

    tbody.innerHTML += `
      <tr class="${cls}">
        <td>${b.name}</td>
        <td>${status}</td>
        <td>${b.maxLoan}</td>
        <td>${reason}</td>
      </tr>
    `;
  });
}
</script>
