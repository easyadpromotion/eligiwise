<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ELIGIWISE ‚Äì Eligibility Check</title>

<!-- PDF Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
    font-family: Arial, sans-serif;
    background:#f4f6f8;
}
.container{
    max-width:1000px;
    margin:20px auto;
    background:#fff;
    padding:20px;
    border-radius:10px;
}
h1{
    text-align:center;
    color:#0A4EA3;
}
label{
    font-weight:bold;
    display:block;
    margin-top:12px;
}
input,select{
    width:100%;
    padding:8px;
    margin-top:5px;
}
button{
    margin-top:15px;
    padding:10px 16px;
    background:#0A4EA3;
    color:#fff;
    border:none;
    border-radius:5px;
    cursor:pointer;
}
button:hover{opacity:.9;}

.summary{
    margin-top:15px;
    font-weight:bold;
}
.summary span{
    margin-right:15px;
}

table{
    width:100%;
    margin-top:15px;
    border-collapse:collapse;
}
th,td{
    border:1px solid #ccc;
    padding:8px;
    text-align:center;
}
th{
    background:#0A4EA3;
    color:#fff;
}

.eligible{color:green;font-weight:bold;}
.noteligible{color:red;font-weight:bold;}

.downloads{
    margin-top:15px;
}
.downloads button{
    margin-right:10px;
}
</style>
</head>

<body>
<div class="container">
<h1>ELIGIWISE ‚Äì Eligibility Check</h1>

<label>Business Vintage (Years)</label>
<input type="number" id="vintage">

<label>Turnover (Lakhs)</label>
<input type="number" id="turnover">

<label>Average Bank Balance ‚Äì ABB (Lakhs)</label>
<input type="number" step="0.01" id="abb">

<label>CIBIL Score</label>
<input type="number" id="cibil">

<label>Banking Type</label>
<select id="bankingType">
    <option>All Accounts Accepted</option>
    <option>Only Current Account</option>
    <option>Only OD/CC Accounts</option>
    <option>Only Saving Accounts</option>
    <option>CA+OD/CC</option>
</select>

<label>Own House</label>
<select id="ownHouse">
    <option>Yes</option>
    <option>No</option>
</select>

<label>GST Available</label>
<select id="gst">
    <option>Yes</option>
    <option>No</option>
</select>

<label>ITR Available</label>
<select id="itr">
    <option>Yes</option>
    <option>No</option>
</select>

<button onclick="checkEligibility()">üîç Check Eligibility</button>

<div class="summary" id="summary"></div>

<table id="resultTable" style="display:none;">
<thead>
<tr>
<th>Bank / NBFC</th>
<th>Status</th>
<th>Remarks</th>
</tr>
</thead>
<tbody></tbody>
</table>

<div class="downloads" id="downloads" style="display:none;">
<button onclick="downloadExcel()">üì• Download Excel</button>
<button onclick="downloadPDF()">üìÑ Download PDF</button>
</div>

</div>

<script>
function checkEligibility(){
    const policies = JSON.parse(localStorage.getItem("eligiwisePolicies")) || [];
    if(policies.length===0){
        alert("No Bank Policies Found");
        return;
    }

    const vintage = Number(document.getElementById("vintage").value);
    const turnover = Number(document.getElementById("turnover").value);
    const abb = Number(document.getElementById("abb").value);
    const cibil = Number(document.getElementById("cibil").value);
    const bankingType = document.getElementById("bankingType").value;
    const ownHouse = document.getElementById("ownHouse").value;
    const gst = document.getElementById("gst").value;
    const itr = document.getElementById("itr").value;

    let eligibleCount=0, notEligibleCount=0;
    const tbody = document.querySelector("#resultTable tbody");
    tbody.innerHTML="";

    policies.forEach(p=>{
        let eligible=true;
        let remarks=[];

        if(p.vintage && vintage < p.vintage){eligible=false;remarks.push("Low Vintage");}
        if(p.turnover && turnover < p.turnover){eligible=false;remarks.push("Low Turnover");}
        if(p.abb && abb < p.abb){eligible=false;remarks.push("Low ABB");}
        if(p.cibil && cibil < p.cibil){eligible=false;remarks.push("Low CIBIL");}
        if(p.bankingType && p.bankingType!=="All Accounts Accepted" && bankingType!==p.bankingType){
            eligible=false;remarks.push("Banking Type Mismatch");
        }
        if(p.ownHouse && ownHouse!==p.ownHouse){eligible=false;remarks.push("Own House Required");}
        if(p.gst && gst!==p.gst){eligible=false;remarks.push("GST Required");}
        if(p.itr && itr!==p.itr){eligible=false;remarks.push("ITR Required");}

        const tr=document.createElement("tr");
        tr.innerHTML=`
            <td>${p.bankName}</td>
            <td class="${eligible?'eligible':'noteligible'}">${eligible?'Eligible':'Not Eligible'}</td>
            <td>${eligible?'All conditions matched':remarks.join(", ")}</td>
        `;
        tbody.appendChild(tr);

        eligible?eligibleCount++:notEligibleCount++;
    });

    document.getElementById("summary").innerHTML =
        `<span class="eligible">‚úÖ Eligible: ${eligibleCount}</span>
         <span class="noteligible">‚ùå Not Eligible: ${notEligibleCount}</span>`;

    document.getElementById("resultTable").style.display="table";
    document.getElementById("downloads").style.display="block";
}

function downloadExcel(){
    let csv="Bank / NBFC,Status,Remarks\n";
    document.querySelectorAll("#resultTable tbody tr").forEach(r=>{
        csv+=Array.from(r.children).map(td=>td.innerText).join(",")+"\n";
    });
    const blob=new Blob([csv],{type:"text/csv"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="Eligwise_Eligibility.csv";
    a.click();
}

function downloadPDF(){
    const {jsPDF}=window.jspdf;
    const doc=new jsPDF();
    doc.setFontSize(14);
    doc.text("ELIGIWISE ‚Äì Eligibility Result",14,15);

    let y=30;
    doc.setFontSize(10);
    doc.text("Bank / NBFC",14,y);
    doc.text("Status",80,y);
    doc.text("Remarks",120,y);
    y+=8;

    document.querySelectorAll("#resultTable tbody tr").forEach(r=>{
        const tds=r.children;
        doc.text(tds[0].innerText,14,y);
        doc.text(tds[1].innerText,80,y);
        doc.text(tds[2].innerText,120,y);
        y+=8;
    });

    doc.save("Eligwise_Eligibility.pdf");
}
</script>
</body>
</html>
