<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ELIGIWISE ‚Äì Eligibility Check</title>

<!-- Excel + PDF libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f6f8;
}
.container {
  max-width:1000px;
  margin:20px auto;
  background:#fff;
  padding:20px;
  border-radius:10px;
}
h1 {
  text-align:center;
  color:#0a4ea3;
}
label {
  font-weight:bold;
  display:block;
  margin-top:10px;
}
input, select {
  width:100%;
  padding:8px;
  margin-top:5px;
}
button {
  margin-top:15px;
  padding:10px 16px;
  background:#0a4ea3;
  color:#fff;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
table {
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
th, td {
  border:1px solid #ccc;
  padding:8px;
  text-align:center;
}
th {
  background:#0a4ea3;
  color:#fff;
}
.status-yes {
  color:green;
  font-weight:bold;
}
.status-no {
  color:red;
  font-weight:bold;
}
.summary {
  margin-top:15px;
  font-weight:bold;
}
.download-btn {
  margin-top:15px;
}
</style>
</head>

<body>
<div class="container">

<h1>ELIGIWISE ‚Äì Eligibility Check</h1>

<label>Turnover (Lakhs)</label>
<input id="turnover" type="number">

<label>Average Bank Balance ‚Äì ABB (Lakhs)</label>
<input id="abb" type="number" step="0.01">

<label>CIBIL Score</label>
<input id="cibil" type="number">

<label>Banking Type</label>
<select id="bankingType">
  <option>All Accounts Accepted</option>
  <option>Current Account Only</option>
</select>

<label>Own House</label>
<select id="ownHouse">
  <option>Yes</option>
  <option>No</option>
</select>

<label>GST Available</label>
<select id="gst">
  <option>Yes</option>
  <option>No</option>
</select>

<label>ITR Available</label>
<select id="itr">
  <option>Yes</option>
  <option>No</option>
</select>

<button onclick="checkEligibility()">üîç Check Eligibility</button>

<div id="summary" class="summary"></div>

<table id="resultTable" style="display:none;">
  <thead>
    <tr>
      <th>Bank / NBFC</th>
      <th>Eligible Loan (‚Çπ Lakhs)</th>
      <th>Status</th>
      <th>Remarks</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div class="download-btn" id="downloadBtns" style="display:none;">
  <button onclick="downloadExcel()">üì• Download Excel</button>
  <button onclick="downloadPDF()">üìÑ Download PDF</button>
</div>

</div>

<script>
function checkEligibility() {

  const turnover = Number(document.getElementById("turnover").value);
  const abb = Number(document.getElementById("abb").value);
  const cibil = Number(document.getElementById("cibil").value);
  const gst = document.getElementById("gst").value;
  const itr = document.getElementById("itr").value;

  const policies = JSON.parse(localStorage.getItem("eligiwisePolicies")) || [];

  if (policies.length === 0) {
    alert("No Bank Policies Found. Please add from Admin Panel.");
    return;
  }

  let eligibleCount = 0;
  let notEligibleCount = 0;

  const tbody = document.querySelector("#resultTable tbody");
  tbody.innerHTML = "";

  policies.forEach(p => {
    let isEligible = true;
    let remark = "All conditions matched";

    if (cibil < (p.cibil || 0)) {
      isEligible = false;
      remark = "Low CIBIL Score";
    }
    if (abb < (p.abb || 0)) {
      isEligible = false;
      remark = "Low ABB";
    }
    if (gst === "No" && p.gst === "Yes") {
      isEligible = false;
      remark = "GST Required";
    }
    if (itr === "No" && p.itr === "Yes") {
      isEligible = false;
      remark = "ITR Required";
    }

    let loan = "-";
    if (isEligible) {
      loan = Math.min(turnover * 0.3, p.maxLoan || turnover).toFixed(2);
      eligibleCount++;
    } else {
      notEligibleCount++;
    }

    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${p.bankName}</td>
      <td>${loan}</td>
      <td class="${isEligible ? 'status-yes' : 'status-no'}">
        ${isEligible ? 'Eligible' : 'Not Eligible'}
      </td>
      <td>${remark}</td>
    `;
    tbody.appendChild(row);
  });

  document.getElementById("summary").innerHTML =
    `‚úÖ Eligible: ${eligibleCount} &nbsp;&nbsp; ‚ùå Not Eligible: ${notEligibleCount}`;

  document.getElementById("resultTable").style.display = "table";
  document.getElementById("downloadBtns").style.display = "block";
}

function downloadExcel() {
  const table = document.getElementById("resultTable");
  const wb = XLSX.utils.table_to_book(table, {sheet:"Eligibility"});
  XLSX.writeFile(wb, "Eligwise_Eligibility.xlsx");
}

function downloadPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.setFont("helvetica","bold");
  doc.text("ELIGIWISE ‚Äì Eligibility Result", 14, 15);

  let y = 30;
  doc.setFont("helvetica","bold");
  doc.text("Bank / NBFC", 14, y);
  doc.text("Loan (Lakhs)", 70, y);
  doc.text("Status", 115, y);
  doc.text("Remarks", 145, y);

  doc.setFont("helvetica","normal");

  document.querySelectorAll("#resultTable tbody tr").forEach(r => {
    y += 10;
    const c = r.children;
    doc.text(c[0].innerText, 14, y);
    doc.text(c[1].innerText, 70, y);
    doc.text(c[2].innerText, 115, y);
    doc.text(c[3].innerText, 145, y);
  });

  doc.save("Eligwise_Eligibility.pdf");
}
</script>

</body>
</html>
