<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ELIGIWISE – Eligibility Check</title>
<style>
body{font-family:Arial;background:#eef2f7;margin:0}
.container{max-width:900px;margin:20px auto;background:#fff;padding:20px;border-radius:10px}
h2{text-align:center;color:#0A4EA3;margin-top:0}
h3{background:#0A4EA3;color:#fff;padding:8px;margin-top:20px;border-radius:4px}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
input,select{width:100%;padding:8px;margin-top:4px;box-sizing:border-box}
button{margin-top:12px;padding:8px 14px;background:#2ea44f;color:#fff;border:none;
       border-radius:4px;cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:15px}
table,th,td{border:1px solid #ccc}
th,td{padding:6px;text-align:left}
#result{margin-top:10px;font-weight:bold}
</style>
<script>
if(localStorage.getItem("role")!=="DSA"){
  alert("Please login as DSA");location.href="login.html";
}
</script>
</head>
<body>
<div class="container">
<h2>Eligibility Check</h2>

<h3>Basic Inputs</h3>
<div class="grid">
  <!-- ABB in lakhs because policy ABB Min/Max are in lakhs (5 – 15 in your screenshot) -->
  <input id="abb" type="number" step="0.01" placeholder="ABB (Lakhs)">

  <select id="gst">
    <option value="No">GST: No</option>
    <option value="Yes">GST: Yes</option>
  </select>

  <select id="itr">
    <option value="No">ITR: No</option>
    <option value="Yes">ITR: Yes</option>
  </select>

  <input id="cibil" type="number" placeholder="CIBIL Score">
  <input id="totalEmi" type="number" placeholder="Existing EMI (₹)">
  <input id="income" type="number" placeholder="Net Monthly Income (₹)">
</div>

<button onclick="checkEligibility()">Check Eligibility</button>
<p id="result"></p>

<table id="eligibleBanks">
  <thead>
    <tr><th>Eligible Bank / NBFC</th><th>Reason</th></tr>
  </thead>
  <tbody></tbody>
</table>
</div>

<script>
function checkEligibility(){
  const abb = Number(document.getElementById("abb").value || 0);
  const gst = document.getElementById("gst").value;
  const itr = document.getElementById("itr").value;
  const cibil = Number(document.getElementById("cibil").value || 0);
  const totalEmi = Number(document.getElementById("totalEmi").value || 0);
  const income = Number(document.getElementById("income").value || 0);

  const policies = JSON.parse(localStorage.getItem("eligiwisepolicies")) || [];

  const tbody = document.querySelector("#eligibleBanks tbody");
  const result = document.getElementById("result");
  tbody.innerHTML = "";
  result.textContent = "";

  if (!policies.length){
    result.textContent = "No policies found. Please ask admin to create policies.";
    return;
  }

  const eligible = policies.filter(p => {
    // ABB condition (same unit as policy: lakhs)
    if (!(abb >= Number(p.abbMin) && abb <= Number(p.abbMax))) return false;

    // GST / ITR
    if (p.gstRequired === "Yes" && gst !== "Yes") return false;
    if (p.itrRequired === "Yes" && itr !== "Yes") return false;

    // Optional CIBIL & EMI checks – only applied if values exist in policy
    if (p.cibilMin && cibil && cibil < p.cibilMin) return false;
    if (p.maxEmiRatio && income > 0){
      const ratio = (totalEmi / income) * 100;
      if (ratio > p.maxEmiRatio) return false;
    }
    return true;
  });

  if (!eligible.length){
    result.textContent = "No eligible banks for given inputs.";
    return;
  }

  eligible.forEach(p => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${p.bankName}</td><td>ABB & GST/ITR matched</td>`;
    tbody.appendChild(tr);
  });
}
</script>
</body>
</html>
